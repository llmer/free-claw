# free-claw

Telegram bot that wraps the `claude` CLI. Send messages from your phone, get responses async. Supports session persistence, identity/personality system, browser access via Playwright, and scheduled tasks.

## Prerequisites

- **Node.js 22+**
- **Claude CLI** installed and authenticated (`claude` must be on your PATH)
- **Telegram bot token** from [@BotFather](https://t.me/BotFather)
- Your **Telegram user ID** (send `/start` to [@userinfobot](https://t.me/userinfobot) to get it)

## Setup

```bash
git clone https://github.com/llmer/free-claw.git && cd free-claw
pnpm install
cp .env.example .env
```

Edit `.env`:

```
TELEGRAM_BOT_TOKEN=123456:ABC-DEF...    # from BotFather
ALLOWED_TELEGRAM_USERS=12345678         # your Telegram user ID (comma-separated for multiple)
WORKSPACE_DIR=~/projects                # working directory for Claude Code
```

Run:

```bash
pnpm dev
```

That's it. Message your bot on Telegram.

## .env reference

| Variable | Default | Description |
|---|---|---|
| `TELEGRAM_BOT_TOKEN` | *required* | Bot token from @BotFather |
| `ALLOWED_TELEGRAM_USERS` | (all) | Comma-separated Telegram user IDs. Leave empty to allow anyone (not recommended). |
| `WORKSPACE_DIR` | `~/projects` | Working directory for Claude Code sessions |
| `DATA_DIR` | `~/.free-claw` | Where session and scheduler data is persisted |
| `CLAUDE_MODEL` | `sonnet` | Default model passed to `claude --model` |
| `ENABLE_BROWSER` | `true` | Enable Playwright MCP for web browsing. Set `false` to disable. |
| `TIMEOUT_MS` | `600000` | Overall process timeout (10 min) |
| `NO_OUTPUT_TIMEOUT_MS` | `180000` | Kill process if no output for this long (3 min) |
| `DEFAULT_TIMEZONE` | system tz | IANA timezone for scheduling (e.g. `America/New_York`) |

## Commands

| Command | Description |
|---|---|
| `/start` | Show help (auto-triggers setup wizard on first run) |
| `/new` | Start a fresh conversation (new session ID) |
| `/cancel` | Kill the running Claude process |
| `/status` | Show current session info |
| `/setup` | Run the identity setup wizard |
| `/soul` | View/edit assistant identity |
| `/memory` | Browse memory and daily logs |
| `/schedule <time> \| <prompt>` | One-off scheduled task |
| `/every <pattern> \| <prompt>` | Recurring scheduled task |
| `/jobs` | List scheduled jobs (interactive) |
| `/canceljob <id>` | Cancel a job (prefix match on 8-char ID) |
| `/runjob <id>` | Force-run a job immediately |
| `/timezone <tz>` | Set your timezone for scheduling |

Any other text message is forwarded directly to Claude Code.

## Identity & workspace

On first run, `/start` auto-triggers the `/setup` wizard — an inline-keyboard flow that walks you through picking a name, creature type, vibe, emoji, and timezone for your assistant, plus your own name.

Setup writes these files into `WORKSPACE_DIR`:

| File | Purpose |
|---|---|
| `SOUL.md` | Core personality and behavioral guidelines |
| `IDENTITY.md` | Name, creature, vibe, emoji — filled in by `/setup` |
| `USER.md` | Info about you (name, timezone, notes) |
| `MEMORY.md` | Long-term curated memories |
| `memory/` | Daily log files (auto-generated by the assistant) |

These files are injected into Claude's system prompt at the start of each session, giving the assistant persistent identity and memory across conversations.

Use `/soul` to view or edit identity files interactively, and `/memory` to browse memory and daily logs — both use inline keyboard UIs.

## Scheduling examples

One-off:
```
/schedule tomorrow at 10pm | remind me about the deadline
/schedule in 2 hours | check deployment status
/schedule Friday at 3pm | review the PR
```

Recurring:
```
/every morning at 9am | summarize my emails
/every weekday at 8:30am | check overnight alerts
/every 30 minutes | monitor the build pipeline
/every Monday at 10am | prepare weekly status report
```

## How it works

The bot spawns `claude` as a child process using documented CLI flags:

```
claude -p --output-format stream-json --dangerously-skip-permissions \
  --session-id <uuid> --model sonnet "your message"
```

Follow-ups use `--resume <session-id>` to maintain conversation context. No API keys are extracted or shared — everything goes through the CLI binary.

Responses stream back to Telegram via edit-in-place (the message updates live as Claude types), then the final complete response replaces the preview.

## Docker

```bash
docker compose up -d
```

The compose file mounts your data and workspace directories. Make sure the `claude` CLI is available inside the container (install it in the Dockerfile or mount the binary).
